#!/bin/bash
# updaterepo.sh - для твоего GitHub Repososi

# 1. Фиксим control в .deb (убираем mobilesubstrate)
for deb in debs/*.deb; do
  dpkg-deb -x "$deb" temp/
  sed -i 's/mobilesubstrate/com.sileo.substitute/g' temp/DEBIAN/control
  sed -i '/mobilesubstrate/d' temp/DEBIAN/control
  dpkg-deb -b temp/ "$deb"
  rm -rf temp/
done

# 2. Генерируем Packages.gz
dpkg-scanpackages debs/ /dev/null | gzip > Packages.gz

# 3. Создаём Release
cat > Release << EOF
Architectures: iphoneos-arm64
Components: main
Origin: Reposi3
Label: Nikitos Repo
Suite: stable
Version: 1.0
Date: $(date -Ru)
EOF

# Хэши
cd dists/stable/main/binary-iphoneos-arm64/
sha1sum Packages.gz > SHA1Sums
sha256sum Packages.gz > SHA256Sums
cd ../../../

gpg --clearsign -o InRelease Release

echo "✅ Готово! Пушь на GitHub и обнови Sileo"
